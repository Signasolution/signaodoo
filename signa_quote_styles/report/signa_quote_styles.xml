<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!--
    V4 (Odoo 18) :
    - On ne remplace plus le contenu du devis : on change uniquement le layout appelé par le devis.
    - Le layout router hérite de web.external_layout (donc variables company/o/doc habituelles OK).
    - Le header choisit un sous-template selon res.partner.x_studio_style_de_devis.
    -->

    <!-- 4 HEADERS indépendants : vous pourrez les modifier séparément (Studio / éditeur de vues). -->
    <template id="signa_header_signasolution">
        <div class="header">
            <div style="display:flex; align-items:center; justify-content:space-between;">
                <div style="font-size:22px; font-weight:700;">LOGO SignaSolution</div>
                <div style="text-align:right; font-size:12px;">
                    <div t-esc="company.name"/>
                    <div t-esc="company.phone or ''"/>
                    <div t-esc="company.email or ''"/>
                </div>
            </div>
            <div style="margin-top:8px; height:10px; background:#0b5cff;"></div>
        </div>
    </template>

    <template id="signa_header_signaparc">
        <div class="header">
            <div style="display:flex; align-items:center; justify-content:space-between;">
                <div style="font-size:22px; font-weight:700;">LOGO SignaParc</div>
                <div style="text-align:right; font-size:12px;">
                    <div t-esc="company.name"/>
                    <div t-esc="company.phone or ''"/>
                    <div t-esc="company.email or ''"/>
                </div>
            </div>
            <div style="margin-top:8px; height:10px; background:#148f2a;"></div>
        </div>
    </template>

    <template id="signa_header_signagolf">
        <div class="header">
            <div style="display:flex; align-items:center; justify-content:space-between;">
                <div style="font-size:22px; font-weight:700;">LOGO SignaGolf</div>
                <div style="text-align:right; font-size:12px;">
                    <div t-esc="company.name"/>
                    <div t-esc="company.phone or ''"/>
                    <div t-esc="company.email or ''"/>
                </div>
            </div>
            <div style="margin-top:8px; height:10px; background:#ff9900;"></div>
        </div>
    </template>

    <template id="signa_header_signaindustrie">
        <div class="header">
            <div style="display:flex; align-items:center; justify-content:space-between;">
                <div style="font-size:22px; font-weight:700;">LOGO SignaIndustrie</div>
                <div style="text-align:right; font-size:12px;">
                    <div t-esc="company.name"/>
                    <div t-esc="company.phone or ''"/>
                    <div t-esc="company.email or ''"/>
                </div>
            </div>
            <div style="margin-top:8px; height:10px; background:#cc0000;"></div>
        </div>
    </template>

    <!-- Layout ROUTER : hérite de web.external_layout et remplace seulement le header -->
    <template id="external_layout_router" inherit_id="web.external_layout">
        <xpath expr="//div[contains(concat(' ', normalize-space(@class), ' '), ' header ')][1]" position="replace">

            <!-- On détermine le document (sale.order) à partir de docs (toujours fourni par le report engine) -->
            <t t-set="doc" t-value="(docs and docs[0]) or False"/>
            <t t-set="signa_style"
               t-value="(doc and doc.partner_id and doc.partner_id._fields.get('x_studio_style_de_devis') and doc.partner_id.x_studio_style_de_devis) or ''"/>

            <t t-if="signa_style == 'SignaSolution'" t-call="signa_quote_styles.signa_header_signasolution"/>
            <t t-elif="signa_style == 'SignaParc'" t-call="signa_quote_styles.signa_header_signaparc"/>
            <t t-elif="signa_style == 'SignaGolf'" t-call="signa_quote_styles.signa_header_signagolf"/>
            <t t-elif="signa_style == 'SignaIndustrie'" t-call="signa_quote_styles.signa_header_signaindustrie"/>

            <!-- Fallback : header standard si style vide / inattendu -->
            <t t-else="">
                <div class="header">
                    <div style="display:flex; align-items:center; justify-content:space-between;">
                        <div style="font-size:18px; font-weight:700;">
                            <span t-esc="company.name"/>
                        </div>
                        <div style="text-align:right; font-size:12px;">
                            <div t-esc="company.phone or ''"/>
                            <div t-esc="company.email or ''"/>
                        </div>
                    </div>
                </div>
            </t>

        </xpath>
    </template>

    <!-- On remplace UNIQUEMENT le t-call du layout dans le devis, sans toucher au contenu -->
    <template id="report_saleorder_document_layout_router" inherit_id="sale.report_saleorder_document">
        <!-- Cas standard -->
        <xpath expr="//t[@t-call='web.external_layout']" position="attributes">
            <attribute name="t-call">signa_quote_styles.external_layout_router</attribute>
        </xpath>

        <!-- Cas où le devis appelle external_layout_standard -->
        <xpath expr="//t[@t-call='web.external_layout_standard']" position="attributes">
            <attribute name="t-call">signa_quote_styles.external_layout_router</attribute>
        </xpath>
    </template>

</odoo>
